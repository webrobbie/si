{% extends 'layout.html' %}
{% block title %}Image{% endblock %}
{% block main %}

<div class='header'>
<!-- previous / next image -->
  <div class='previous-next'>
    {% if Image.query.get(image.rank-1) in image.post.images %}
      <a href='{{ url_for("image",rank=image.rank-1) }}'><button>Previous</button></a>
    {% endif %}
    {% if Image.query.get(image.rank+1) in image.post.images %}
      <a href='{{ url_for("image",rank=image.rank+1) }}'><button>Next</button></a>
    {% endif %}
  </div>
<!-- buttons -->
  <div>
    <a class='button orange' href='{{ url_for("edit_image",rank=image.rank) }}'>edit</a>
    <a class='button red' href='{{ url_for("delete_image",rank=image.rank) }}'>delete</a>
  </div>
</div>

{% if image.body %}
  <p>{{ image.body_to_html()|safe }}</p>
{% endif %}
<a href='{{ url_for("static",filename="upload/"+image.filename) }}'>
  <img class='image-img' src='{{ url_for("static",filename="upload/"+image.filename) }}'>
</a>
<br><hr><br>

<h2>Comments</h2>
<br>
{% for comment in image.comments %}
  <article class='card comment'>
    <div class='header'>
      <h4>{{ comment.author }}</h4>
      <div>
        <span class='time'>{{ comment.time.day }}/{{ comment.time.month }}/{{ comment.time.year }}</span>
        {% if current_user.is_authenticated %}
          <a class='button red' href='{{ url_for("delete_comment",comment_id=comment.id) }}'>delete</a>
        {% endif %} 
      </div>
    </div>
    <div class='body'>
      <p>{{ comment.body }}</p>
    </div>
  </article>
{% endfor %}
<br><hr><br>

<h2>Leave a comment</h2>
<br>
<form method='post'>
{{ form.csrf_token }}
  <!-- author -->
  <strong>{{ form.author.label }}</strong><br>
  {{ form.author }}
  <p class='error'>{{ form.author.errors[0] }}</p>
  <!-- body -->
  <strong>{{ form.body.label }}</strong><br>
  {{ form.body(rows='3') }}
  <p class='error'>{{ form.body.errors[0] }}</p>
  <!-- submit -->
  <button type='submit'>Submit</button>
</form>

{% endblock %}
